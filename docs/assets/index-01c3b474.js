var v=Object.defineProperty;var b=(n,t,e)=>t in n?v(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var c=(n,t,e)=>(b(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();const s=9,u=3;class N{solve(t){let e=!0,o,r=[];for(;!(e===!0&&(o=this.getNextFreeCell(t),o===void 0));)if(this.setNextAllowedValue(t,o),o.value!=0)t.rows[o.rowNo].cols[o.colNo].value=o.value,r.push(o),e=!0;else{if(r.length===0)return console.log("Sudoku not valid"),!1;o=r.pop(),t.rows[o.rowNo].cols[o.colNo].value=0,e=!1}return console.log("Sudoku valid"),!0}getNextFreeCell(t){for(let e=0;e<s;e++)for(let o=0;o<s;o++)if(t.rows[e].cols[o].value===0)return{rowNo:e,colNo:o,value:0}}setNextAllowedValue(t,e){for(let o=e.value+1;o<=s;o++)if(this.isValueAllowed(t,e.colNo,e.rowNo,o)){e.value=o;return}e.value=0}hasRowValue(t,e,o){let r=!1;return t.rows[e].cols.every(l=>l.value===o?(r=!0,!1):!0),r}hasColValue(t,e,o){let r=!1;return t.rows.every(l=>l.cols[e].value===o?(r=!0,!1):!0),r}hasBoxValue(t,e,o,r){let l=o-o%u,i=e-e%u,a=l-1,d=i;for(let f=0;f<s;f++){if(f%u===0&&(a=a+1,d=i),t.rows[a].cols[d].value===r)return!0;d=d+1}return!1}isValueAllowed(t,e,o,r){return!this.hasRowValue(t,o,r)&&!this.hasColValue(t,e,r)&&!this.hasBoxValue(t,e,o,r)}isWon(t){for(let e=0;e<s;e++)for(let o=0;o<s;o++)if(t.rows[e].cols[o].value===0)return!1;return!0}getValueCount(t){let e=[];for(let o=0;o<=s;o++)e.push({count:0});for(let o=0;o<s;o++)for(let r=0;r<s;r++){let l=t.rows[o].cols[r].value;e[l].count++}return e}}class g{constructor(){c(this,"board",{rows:[]});c(this,"backupBoard",{rows:[]})}getBoard(){return this.board}generateSudoku(){for(;;)if(this.createInitialBoard(),this.fillBoxes(),new N().solve(this.board)===!0){this.setFix();break}}setFix(){for(let t=0;t<s;t++)for(let e=0;e<s;e++)this.board.rows[t].cols[e].value!==0&&(this.board.rows[t].cols[e].fix=!0)}reduceBoard(t){let e=t,o,r;for(;e>0;)o=Math.floor(Math.random()*s),r=Math.floor(Math.random()*s),this.board.rows[o].cols[r].value!==0&&(this.board.rows[o].cols[r].value=0,this.board.rows[o].cols[r].fix=!1,e=e-1);this.backupBoard=JSON.parse(JSON.stringify(this.board))}createInitialBoard(){this.board.rows=[];for(let t=0;t<s;t++){let e={rowNo:t,cols:[]};for(let o=0;o<s;o++){let r={colNo:o,value:0,fix:!1};e.cols.push(r)}this.board.rows.push(e)}}fillBoxes(){this.generateBox(0,0,this.board),this.generateBox(3,3,this.board),this.generateBox(6,6,this.board),console.log(this.board),this.printBoard()}generateBox(t,e,o){const r=this.getRandomArray();let l=t,i=e,a=0;r.forEach(d=>{o.rows[l].cols[i].value=d,i=i+1,a=a+1,a%u===0&&(l=l+1,i=e)})}getRandomArray(){let t=[];for(let e=1;e<=s;e++)t.push(e);return this.shuffleArray(t)}shuffleArray(t){let e=t.length,o;for(;e!=0;)o=Math.floor(Math.random()*e),e--,[t[e],t[o]]=[t[o],t[e]];return t}printBoard(){let t=[],e="",o="-";for(let r=1;r<=s;r++)o=o+"-",r%u===0&&(o=o+"-");this.board.rows.forEach(r=>{e="",r.cols.forEach(l=>{l.colNo%u===0&&(e=e+"|"),e=e+l.value.toString()}),e=e+"|",r.rowNo%u===0&&t.push(o),t.push(e)}),t.push(o),t.forEach(r=>{console.log(r)})}resetBoard(){this.board=JSON.parse(JSON.stringify(this.backupBoard))}}class w{constructor(t){c(this,"board");c(this,"curActionNumber");c(this,"solver");c(this,"callBackNewGameStart");c(this,"generator");c(this,"errNotSolveable");c(this,"errNotAllowed");this.solver=new N,this.generator=t,this.errNotSolveable="Not solveable",this.errNotAllowed="Not allowed",this.addClickEvents(),this.setText()}addClickEvents(){this.addClickEventNewGame(),this.addClickEventResetGame(),this.addClickEventActionNumber(),this.addClickEventCells(),this.addClickEventDelete(),this.addClickEventToHeader(),this.addClickEventDialogNewGameStart()}initBoard(t){this.board=t,this.curActionNumber=1,this.placeOnBoard(),this.removeColorsFromBord(),this.markActionsDone(),this.curActionNumber=this.setFreeActionNumber(),this.setColorOnBoard(this.curActionNumber)}setFreeActionNumber(){var e;let t=document.getElementsByClassName("actionNumberSel");for(let o=0;o<t.length;o++)if(!((e=t.item(o))!=null&&e.classList.contains("actionNumberDone")))return o+1;return 1}placeOnBoard(){this.clearBoard();for(let t=0;t<s;t++)for(let e=0;e<s;e++){let o=this.board.rows[t].cols[e].value;if(o!=0){let r="c"+t.toString()+e.toString(),l=document.getElementById(r);l.innerText=o.toString(),this.board.rows[t].cols[e].fix===!0&&l.classList.add("fixCell")}}}clearBoard(){for(let t=0;t<s;t++)for(let e=0;e<s;e++){let o="c"+t.toString()+e.toString(),r=document.getElementById(o);r.innerText="",r.classList.remove("fixCell")}}addClickEventToHeader(){document.getElementById("header").addEventListener("click",async()=>{this.clickOnHeader()})}clickOnHeader(){window.location.href="https://github.com/fmabap/sudoku"}addClickEventActionNumber(){var e;let t=document.getElementsByClassName("actionNumberSel");for(let o=0;o<t.length;o++)(e=t.item(o))==null||e.addEventListener("click",()=>{this.clickActionNumber(t.item(o))})}addClickEventDialogNewGameStart(){document.getElementById("dialogNewOk").addEventListener("click",()=>{this.clickNewGameStart()})}addClickEventDelete(){document.getElementById("delete").addEventListener("click",()=>{this.clickDelete()})}addClickEventNewGame(){document.getElementById("newGame").addEventListener("click",()=>{this.clickNewGame()})}clickDelete(){this.removeColorsFromBord(),this.curActionNumber=0;for(let t=0;t<s;t++)for(let e=0;e<s;e++)if(this.board.rows[t].cols[e].value!=0&&this.board.rows[t].cols[e].fix===!1){let r="c"+t.toString()+e.toString();document.getElementById(r).classList.add("delete")}}clickNewGame(){this.requestNewGameOptions(this.callBackNewGameStart)}addClickEventResetGame(){document.getElementById("resetGame").addEventListener("click",()=>{this.clickResetGame()})}clickResetGame(){this.generator.resetBoard(),this.initBoard(this.generator.getBoard())}addClickEventCells(){var e;let t=document.getElementsByClassName("boardCell");for(let o=0;o<t.length;o++)(e=t.item(o))==null||e.addEventListener("click",()=>{this.clickCell(t.item(o))})}isSolveableCheckRequired(){let t=document.getElementById("checkSolveable");return console.log(t.value),t.checked}clickCell(t){let e=parseInt(t.id.substring(1,2)),o=parseInt(t.id.substring(2,3)),r=t,l=JSON.parse(JSON.stringify(this.board));if(this.board.rows[e].cols[o].fix===!1||this.board.rows[e].cols[o].value===this.curActionNumber){if(this.curActionNumber===0){this.board.rows[e].cols[o].value=this.curActionNumber,r.innerText="",r.classList.remove("delete"),this.setColorOnBoard(this.curActionNumber),this.markActionsDone();return}l.rows[e].cols[o].value=0,this.solver.isValueAllowed(l,o,e,this.curActionNumber)?(l.rows[e].cols[o].value=this.curActionNumber,this.isSolveableCheckRequired()===!1||this.solver.solve(l)?(this.board.rows[e].cols[o].value=this.curActionNumber,r.innerText=this.curActionNumber.toString(),this.setColorOnBoard(this.curActionNumber),this.solver.isWon(this.board)&&this.showWon()):this.toastError(this.errNotSolveable)):this.toastError(this.errNotAllowed)}else this.toastError(this.errNotAllowed);this.markActionsDone()}markActionsDone(){this.solver.getValueCount(this.board).forEach((e,o)=>{if(o>0){let r="actionNumber"+o,l=document.getElementById(r);e.count===s?l.classList.add("actionNumberDone"):l.classList.remove("actionNumberDone")}})}showWon(){this.setElementVisible("won"),setTimeout(()=>{this.hideWon()},5e3)}hideWon(){this.setElementInvisible("won")}clickActionNumber(t){this.removeColorsFromBord();for(let e=0;e<=s;e++){let o="colorNumber"+e.toString();if(t.classList.contains(o)){this.setColorOnBoard(e);break}}}removeColorsFromBord(){var e,o;let t=document.getElementsByClassName("boardCell");for(let r=1;r<=s;r++){let l="colorNumber"+r.toString();for(let i=0;i<t.length;i++)(e=t.item(i))==null||e.classList.remove(l),(o=t.item(i))==null||o.classList.remove("delete")}}setColorOnBoard(t){this.curActionNumber=t;let e="colorNumber"+t.toString();for(let o=0;o<s;o++)for(let r=0;r<s;r++)if(this.board.rows[o].cols[r].value===t){let l="c"+o.toString()+r.toString();document.getElementById(l).classList.add(e)}}toastError(t,e=1e3){let o=document.getElementById("error");o.innerText=t,this.setElementVisible("error"),setTimeout(()=>{this.hideError()},e)}hideError(){this.setElementInvisible("error")}setElementInvisible(t){let e=document.getElementById(t);(e==null?void 0:e.classList.contains("hidden"))!==!0&&(e==null||e.classList.add("hidden"))}setElementVisible(t){let e=document.getElementById(t);e==null||e.classList.remove("hidden")}requestNewGameOptions(t){let e=document.getElementById("dialogNewGame");this.callBackNewGameStart=t,e.showModal()}getCountNumbers(){let t=document.getElementById("inputCountNumbers");return parseInt(t.value)}clickNewGameStart(){document.getElementById("dialogNewGame").close(),this.callBackNewGameStart()}setText(){let t=document.getElementById("newGameHeadLine"),e=document.getElementById("labelCountNumbers"),o=document.getElementById("labelCheckSolveable"),r=document.getElementById("dialogNewOk"),l=document.getElementById("delete"),i=document.getElementById("resetGame"),a=document.getElementById("newGame"),d=document.getElementById("won");navigator.language.indexOf("de")>-1&&(t.innerText="Neues Spiel",e.innerText="Anzahl Zahlen: ",o.innerText="Lösbarkeit überprüfen: ",r.innerText="Spiel starten",l.innerText="Entf.",i.innerText="Reset",a.innerHTML="Neues Spiel",d.innerHTML="Du hast gewonnen",this.errNotSolveable="Nicht lösbar",this.errNotAllowed="Nicht erlaubt")}}window.addEventListener("load",()=>{B()});E();let h,m;function B(){h=new g,m=new w(h),m.requestNewGameOptions(C)}function E(){let n="",t="";for(let i=0;i<82;i++){let a=Math.floor(Math.random()*s);t=t+a.toString(),n=n+String.fromCodePoint(a+65)}let e=btoa(n);console.log(t),console.log(n),console.log(e);let o=atob(e);console.log(o);let r="",l;for(let i=0;i<82;i++)l=n.substring(i,i+1),r=r+(l.charCodeAt(0)-65).toString();console.log(r)}function C(){h.generateSudoku(),h.printBoard(),h.reduceBoard(s*s-m.getCountNumbers()),m.initBoard(h.getBoard())}
