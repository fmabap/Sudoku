var g=Object.defineProperty;var w=(n,e,t)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(w(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=t(l);fetch(l.href,r)}})();const i=9,u=3;class N{solve(e){let t=!0,o,l=[];for(;!(t===!0&&(o=this.getNextFreeCell(e),o===void 0));)if(this.setNextAllowedValue(e,o),o.value!=0)e.rows[o.rowNo].cols[o.colNo].value=o.value,l.push(o),t=!0;else{if(l.length===0)return console.log("Sudoku not valid"),!1;o=l.pop(),e.rows[o.rowNo].cols[o.colNo].value=0,t=!1}return console.log("Sudoku valid"),!0}getNextFreeCell(e){for(let t=0;t<i;t++)for(let o=0;o<i;o++)if(e.rows[t].cols[o].value===0)return{rowNo:t,colNo:o,value:0}}setNextAllowedValue(e,t){for(let o=t.value+1;o<=i;o++)if(this.isValueAllowed(e,t.colNo,t.rowNo,o)){t.value=o;return}t.value=0}hasRowValue(e,t,o){let l=!1;return e.rows[t].cols.every(r=>r.value===o?(l=!0,!1):!0),l}hasColValue(e,t,o){let l=!1;return e.rows.every(r=>r.cols[t].value===o?(l=!0,!1):!0),l}hasBoxValue(e,t,o,l){let r=o-o%u,s=t-t%u,a=r-1,d=s;for(let f=0;f<i;f++){if(f%u===0&&(a=a+1,d=s),e.rows[a].cols[d].value===l)return!0;d=d+1}return!1}isValueAllowed(e,t,o,l){return!this.hasRowValue(e,o,l)&&!this.hasColValue(e,t,l)&&!this.hasBoxValue(e,t,o,l)}isWon(e){for(let t=0;t<i;t++)for(let o=0;o<i;o++)if(e.rows[t].cols[o].value===0)return!1;return!0}}class v{constructor(){c(this,"board",{rows:[]});c(this,"backupBoard",{rows:[]})}getBoard(){return this.board}generateSudoku(){for(;;)if(this.createInitialBoard(),this.fillBoxes(),new N().solve(this.board)===!0){this.setFix();break}}setFix(){for(let e=0;e<i;e++)for(let t=0;t<i;t++)this.board.rows[e].cols[t].value!==0&&(this.board.rows[e].cols[t].fix=!0)}reduceBoard(e){let t=e,o,l;for(;t>0;)o=Math.floor(Math.random()*i),l=Math.floor(Math.random()*i),this.board.rows[o].cols[l].value!==0&&(this.board.rows[o].cols[l].value=0,this.board.rows[o].cols[l].fix=!1,t=t-1);this.backupBoard=JSON.parse(JSON.stringify(this.board))}createInitialBoard(){this.board.rows=[];for(let e=0;e<i;e++){let t={rowNo:e,cols:[]};for(let o=0;o<i;o++){let l={colNo:o,value:0,fix:!1};t.cols.push(l)}this.board.rows.push(t)}}fillBoxes(){this.generateBox(0,0,this.board),this.generateBox(3,3,this.board),this.generateBox(6,6,this.board),console.log(this.board),this.printBoard()}generateBox(e,t,o){const l=this.getRandomArray();let r=e,s=t,a=0;l.forEach(d=>{o.rows[r].cols[s].value=d,s=s+1,a=a+1,a%u===0&&(r=r+1,s=t)})}getRandomArray(){let e=[];for(let t=1;t<=i;t++)e.push(t);return this.shuffleArray(e)}shuffleArray(e){let t=e.length,o;for(;t!=0;)o=Math.floor(Math.random()*t),t--,[e[t],e[o]]=[e[o],e[t]];return e}printBoard(){let e=[],t="",o="-";for(let l=1;l<=i;l++)o=o+"-",l%u===0&&(o=o+"-");this.board.rows.forEach(l=>{t="",l.cols.forEach(r=>{r.colNo%u===0&&(t=t+"|"),t=t+r.value.toString()}),t=t+"|",l.rowNo%u===0&&e.push(o),e.push(t)}),e.push(o),e.forEach(l=>{console.log(l)})}resetBoard(){this.board=JSON.parse(JSON.stringify(this.backupBoard))}}class b{constructor(e){c(this,"board");c(this,"curActionNumber");c(this,"solver");c(this,"callBackNewGameStart");c(this,"generator");c(this,"errNotSolveable");c(this,"errNotAllowed");this.solver=new N,this.generator=e,this.errNotSolveable="Not solveable",this.errNotAllowed="Not allowed",this.addClickEvents(),this.setText()}addClickEvents(){this.addClickEventNewGame(),this.addClickEventResetGame(),this.addClickEventActionNumber(),this.addClickEventCells(),this.addClickEventDelete(),this.addClickEventToHeader(),this.addClickEventDialogNewGameStart()}initBoard(e){this.board=e,this.curActionNumber=1,this.placeOnBoard(),this.removeColorsFromBord(),this.setColorOnBoard(this.curActionNumber)}placeOnBoard(){this.clearBoard();for(let e=0;e<i;e++)for(let t=0;t<i;t++){let o=this.board.rows[e].cols[t].value;if(o!=0){let l="c"+e.toString()+t.toString(),r=document.getElementById(l);r.innerText=o.toString(),this.board.rows[e].cols[t].fix===!0&&r.classList.add("fixCell")}}}clearBoard(){for(let e=0;e<i;e++)for(let t=0;t<i;t++){let o="c"+e.toString()+t.toString(),l=document.getElementById(o);l.innerText="",l.classList.remove("fixCell")}}addClickEventToHeader(){document.getElementById("header").addEventListener("click",async()=>{this.clickOnHeader()})}clickOnHeader(){window.location.href="https://github.com/fmabap/sudoku"}addClickEventActionNumber(){var t;let e=document.getElementsByClassName("actionNumberSel");for(let o=0;o<e.length;o++)(t=e.item(o))==null||t.addEventListener("click",()=>{this.clickActionNumber(e.item(o))})}addClickEventDialogNewGameStart(){document.getElementById("dialogNewOk").addEventListener("click",()=>{this.clickNewGameStart()})}addClickEventDelete(){document.getElementById("delete").addEventListener("click",()=>{this.clickDelete()})}addClickEventNewGame(){document.getElementById("newGame").addEventListener("click",()=>{this.clickNewGame()})}clickDelete(){this.removeColorsFromBord(),this.curActionNumber=0;for(let e=0;e<i;e++)for(let t=0;t<i;t++)if(this.board.rows[e].cols[t].value!=0&&this.board.rows[e].cols[t].fix===!1){let l="c"+e.toString()+t.toString();document.getElementById(l).classList.add("delete")}}clickNewGame(){this.requestNewGameOptions(this.callBackNewGameStart)}addClickEventResetGame(){document.getElementById("resetGame").addEventListener("click",()=>{this.clickResetGame()})}clickResetGame(){this.generator.resetBoard(),this.initBoard(this.generator.getBoard())}addClickEventCells(){var t;let e=document.getElementsByClassName("boardCell");for(let o=0;o<e.length;o++)(t=e.item(o))==null||t.addEventListener("click",()=>{this.clickCell(e.item(o))})}isSolveableCheckRequired(){let e=document.getElementById("checkSolveable");return console.log(e.value),e.checked}clickCell(e){let t=parseInt(e.id.substring(1,2)),o=parseInt(e.id.substring(2,3)),l=e,r=JSON.parse(JSON.stringify(this.board));if(this.board.rows[t].cols[o].fix===!1||this.board.rows[t].cols[o].value===this.curActionNumber){if(this.curActionNumber===0){this.board.rows[t].cols[o].value=this.curActionNumber,l.innerText="",l.classList.remove("delete"),this.setColorOnBoard(this.curActionNumber);return}r.rows[t].cols[o].value=0,this.solver.isValueAllowed(r,o,t,this.curActionNumber)?(r.rows[t].cols[o].value=this.curActionNumber,this.isSolveableCheckRequired()===!1||this.solver.solve(r)?(this.board.rows[t].cols[o].value=this.curActionNumber,l.innerText=this.curActionNumber.toString(),this.setColorOnBoard(this.curActionNumber),this.solver.isWon(this.board)&&this.showWon()):this.toastError(this.errNotSolveable)):this.toastError(this.errNotAllowed)}else this.toastError(this.errNotAllowed)}showWon(){this.setElementVisible("won"),setTimeout(()=>{this.hideWon()},5e3)}hideWon(){this.setElementInvisible("won")}clickActionNumber(e){this.removeColorsFromBord();for(let t=0;t<=i;t++){let o="colorNumber"+t.toString();if(e.classList.contains(o)){this.setColorOnBoard(t);break}}}removeColorsFromBord(){var t,o;let e=document.getElementsByClassName("boardCell");for(let l=1;l<=i;l++){let r="colorNumber"+l.toString();for(let s=0;s<e.length;s++)(t=e.item(s))==null||t.classList.remove(r),(o=e.item(s))==null||o.classList.remove("delete")}}setColorOnBoard(e){this.curActionNumber=e;let t="colorNumber"+e.toString();for(let o=0;o<i;o++)for(let l=0;l<i;l++)if(this.board.rows[o].cols[l].value===e){let r="c"+o.toString()+l.toString();document.getElementById(r).classList.add(t)}}toastError(e,t=1e3){let o=document.getElementById("error");o.innerText=e,this.setElementVisible("error"),setTimeout(()=>{this.hideError()},t)}hideError(){this.setElementInvisible("error")}setElementInvisible(e){let t=document.getElementById(e);(t==null?void 0:t.classList.contains("hidden"))!==!0&&(t==null||t.classList.add("hidden"))}setElementVisible(e){let t=document.getElementById(e);t==null||t.classList.remove("hidden")}requestNewGameOptions(e){let t=document.getElementById("dialogNewGame");this.callBackNewGameStart=e,t.showModal()}getCountNumbers(){let e=document.getElementById("inputCountNumbers");return parseInt(e.value)}clickNewGameStart(){document.getElementById("dialogNewGame").close(),this.callBackNewGameStart()}setText(){let e=document.getElementById("newGameHeadLine"),t=document.getElementById("labelCountNumbers"),o=document.getElementById("labelCheckSolveable"),l=document.getElementById("dialogNewOk"),r=document.getElementById("delete"),s=document.getElementById("resetGame"),a=document.getElementById("newGame"),d=document.getElementById("won");navigator.language.indexOf("de")>-1&&(e.innerText="Neues Spiel",t.innerText="Anzahl Zahlen: ",o.innerText="Lösbarkeit überprüfen: ",l.innerText="Spiel starten",r.innerText="Entf.",s.innerText="Reset",a.innerHTML="Neues Spiel",d.innerHTML="Du hast gewonnen",this.errNotSolveable="Nicht lösbar",this.errNotAllowed="Nicht erlaubt")}}window.addEventListener("load",()=>{B()});E();let h,m;function B(){h=new v,m=new b(h),m.requestNewGameOptions(C);var n=document.getElementById("viewport-meta"),e=`width=${window.innerWidth}, height=${window.innerHeight}, initial-scale=1, user-scalable=yes, maximum-scale=5`;n==null||n.setAttribute("content",e)}function E(){let n="",e="";for(let s=0;s<82;s++){let a=Math.floor(Math.random()*i);e=e+a.toString(),n=n+String.fromCodePoint(a+65)}let t=btoa(n);console.log(e),console.log(n),console.log(t);let o=atob(t);console.log(o);let l="",r;for(let s=0;s<82;s++)r=n.substring(s,s+1),l=l+(r.charCodeAt(0)-65).toString();console.log(l)}function C(){h.generateSudoku(),h.printBoard(),h.reduceBoard(i*i-m.getCountNumbers()),m.initBoard(h.getBoard())}
